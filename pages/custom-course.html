<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet" />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <link rel="icon" type="image/x-icon" href="../assets/images/icon/icon-infinite.svg" />
    <title>Coding∞bit ｜ 課程需求一覽表</title>
  </head>
  <body class="bg-custom-course">
    <!-- header -->
    <header class="header-custom-course bg-white shadow-sm">
      <div class="container">
        <nav class="py-3">
          <div
            class="d-flex flex-column flex-lg-row align-items-lg-center flex-wrap position-relative pe-lg-10 row-gap-4"
          >
            <!-- 導覽&搜尋框 -->
            <div class="d-flex align-items-center">
              <div class="navigationArrows d-none d-lg-flex">
                <div class="circle left-btn">
                  <span class="material-symbols-outlined icon-fill">arrow_back</span>
                </div>
                <div class="circle right-btn">
                  <span class="material-symbols-outlined icon-fill">arrow_forward</span>
                </div>
              </div>
              <div class="searchInput pe-10">
                <input
                  type="search"
                  name="courseSearch"
                  class="form-control search-course border-1 border-gray-03"
                  placeholder="搜尋課程需求"
                />
              </div>
            </div>
            <!-- 篩選器 -->
            <div class="d-flex column-gap-4 pe-6 order-lg-1 order-2 ms-lg-auto">
              <button class="btn status-btn text-brand-03 f-align-center">
                <span class="material-symbols-outlined icon">radio_button_unchecked</span>
                <span>已完成</span>
              </button>
              <button class="btn status-btn text-brand-03 f-align-center">
                <span class="material-symbols-outlined icon icon-fill">check_circle</span>
                <span>已回應</span>
              </button>
            </div>
            <!-- 下拉霸 -->
            <div class="d-flex column-gap-4 pe-lg-6 order-lg-2 order-1">
              <div class="dropdown">
                <button
                  class="btn btn-outline-brand-03 dropdown-toggle"
                  type="button"
                  id="sortDropdown"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  排序方式
                </button>
                <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                  <li><a class="dropdown-item" href="#">遞增</a></li>
                  <li><a class="dropdown-item" href="#">遞減</a></li>
                </ul>
              </div>
              <div class="dropdown">
                <button
                  class="btn btn-outline-brand-03 dropdown-toggle"
                  type="button"
                  id="formatDropdown"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  HTML
                </button>
                <ul class="dropdown-menu" aria-labelledby="formatDropdown">
                  <li><a class="dropdown-item" href="#">HTML</a></li>
                  <li><a class="dropdown-item" href="#">CSS</a></li>
                  <li><a class="dropdown-item" href="#">JavaScript</a></li>
                </ul>
              </div>
            </div>

            <!-- 回首頁 -->
            <button class="position-absolute border-0 end-0 top-0 btn p-2">
              <a href="index.html">
                <span class="material-symbols-outlined icon-fill" style="width: 28px; height: 28px"> close </span>
              </a>
            </button>
          </div>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <!-- wishpool -->
      <section class="custom-course-wishpool">
        <div class="wishpool-container">
          <div class="cards-container">
            <!-- 卡片將由 JavaScript 動態生成 -->
          </div>
          <div class="timeline-container">
            <!-- 時間點將由 JavaScript 動態生成 -->
          </div>
        </div>
      </section>

      <section class="time-line mt-auto">
        <!-- <div class="f-between">
          <span class="bg-brand-01 rounded-top-2 px-2 py-1 text-black">10月1日</span>
        <span class="bg-brand-01 rounded-top-2 px-2 py-1 text-black">10月2日</span>
        <span class="bg-brand-01 rounded-top-2 px-2 py-1 text-black">10月3日</span>
        <span class="bg-brand-01 rounded-top-2 px-2 py-1 text-black">10月4日</span>
        </div> -->
        <div class="bg-brand-01" style="height: 8px"></div>
      </section>
    </main>

    <!-- footer-learning-needs -->
    <footer class="footer-learning-needs">
      <div class="container">
        <div class="banner">
          <div class="banner-text">
            <h1 class="title display-1">學習，<br />不再受侷限。</h1>
            <p class="subtitle text-brand-03">大膽提出你的學習需求</p>
          </div>
          <div class="d-flex flex-column align-items-center">
            <button class="add-button" aria-label="提學習需求">
              <span class="add-icon material-symbols-outlined icon-fill"> add </span>
            </button>
            <span class="fs-md-5 fs-6 text-gray-02 d-block mt-2">提學習需求</span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Modal HTML 結構 -->
    <div
      class="modal fade custom-modal"
      id="cardModal"
      tabindex="-1"
      aria-labelledby="cardModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header px-4">
            <h5 class="modal-title" id="cardModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="content-wrapper">
              <!-- 左側欄：原需求、作者信息、標籤、照片 -->
              <div class="left-column col-md-6">
                <div class="scrollable-content p-4">
                  <div class="d-flex align-items-center mb-3">
                    <img
                      id="modalAuthorAvatar"
                      src=""
                      alt="作者頭像"
                      class="rounded-circle me-2"
                      width="40"
                      height="40"
                    />
                    <h6 id="modalAuthorName" class="mb-0"></h6>
                  </div>
                  <p id="modalContent" class="mb-3"></p>
                  <div id="modalTags" class="mb-3"></div>
                  <small id="modalDate" class="text-muted d-block mb-3"></small>
                  <img id="modalPhoto" src="" alt="相關照片" class="img-fluid mb-3" />
                </div>

                <div class="fixed-bottom-form">
                  <h6 class="mb-3">新增回應：</h6>
                  <form id="newResponseForm">
                    <div class="mb-3">
                      <textarea class="form-control rounded-2" rows="3" placeholder="請輸入您的回應..."></textarea>
                    </div>
                    <div class="form-actions">
                      <button type="submit" class="btn btn-primary">提交回應</button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- 右側欄：回覆意見 -->
              <div class="right-column col-md-6">
                <div class="scrollable-content p-4">
                  <h6 class="mb-3">回覆意見：</h6>
                  <div id="modalResponses" class="comments-container">
                    <!-- 回覆將在這裡動態插入 -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="../main.js"></script>
    <script>
      // 卡片數據
      const cardData = [
        {
          id: '1',
          category: 'CSS',
          responseCount: 15,
          title: 'CSS 毛玻璃製作效果',
          content:
            '想知道CSS 毛玻璃效果如何製作，因為這種效果在網頁設計中真的非常吸引人。無論是讓背景模糊，還是創造一種通透感，都能為用戶界面增添獨特的視覺體驗。我特別想了解如何控制模糊程度，以及如何處理不同瀏覽器的兼容性問題。有沒有人可以分享一些實用的技巧或教程資源？',
          date: '2024-10-01 09:15',
          author: {
            name: '阿麥',
            avatar: '../assets/images/user/user-1.png',
          },
          status: 'in-progress',
          tags: ['CSS3', 'UI/UX', '視覺效果'],
          responses: [
            {
              id: 'r1',
              author: 'MOMO',
              avatar: '../assets/images/user/user-2.png',
              content:
                '阿麥同學您好，針對您的問題，我寫了一支教學影片，希望能解決您的問題！影片中我詳細介紹了如何使用 CSS 的 backdrop-filter 屬性來創建毛玻璃效果，以及如何使用 filter 屬性作為備選方案。我也談到了一些常見的瀏覽器兼容性問題及其解決方法。您可以在這裡找到影片鏈接：[影片鏈接]',
              date: '2024/1/10 20:23',
              likes: 5,
            },
            {
              id: 'r2',
              author: 'Ren Lin',
              avatar: '../assets/images/user/user-3.png',
              content:
                '阿麥同學您好，除了 MOMO 提供的優秀教學影片外，我還想補充一點：對於一些較舊的瀏覽器，您可能需要使用偽元素和 blur() 濾鏡來模擬毛玻璃效果。這裡有一個 CodePen 示例，展示了幾種不同的實現方法，包括對舊版瀏覽器的兼容處理：[CodePen 鏈接]。希望這能幫到您！',
              date: '2024/2/2 08:06',
              likes: 3,
            },
          ],
        },
        {
          id: '2',
          category: 'SCSS',
          responseCount: 8,
          title: 'SCSS 7+1設計模式',
          content:
            '我想要瞭解一下關於 SCSS 7+1 設計模式的詳細文章，想瞭解這個模式如何幫助我組織大型專案的樣式。我聽說這種模式可以大大提高樣式的可維護性和可擴展性，但不太確定如何在實際項目中正確實施。有沒有人可以分享一些使用經驗或者推薦一些深入的教程資源？',
          date: '2024-10-01 14:30',
          author: {
            name: 'CSS愛好者',
            avatar: '../assets/images/user/user-2.png',
          },
          status: 'pending',
          tags: ['SCSS', '架構設計', '最佳實踐'],
          responses: [
            {
              id: 'r3',
              author: 'SCSS達人',
              avatar: '../assets/images/user/user-3.png',
              content:
                '您好，CSS愛好者！SCSS 7+1 模式確實是一個很好的大型專案樣式組織方法。這裡有一篇詳細的文章介紹了這種模式：[文章連結]。簡單來說，它將樣式文件分為7個文件夾和1個主文件，幫助您更好地組織代碼。我個人在幾個大型專案中使用過，確實提高了代碼的可維護性。',
              date: '2024/10/2 10:15',
              likes: 6,
            },
          ],
        },
        {
          id: '3',
          category: 'JS',
          responseCount: 12,
          title: '表格渲染錯誤',
          content:
            '網站中有張表格渲染錯誤，這張表是個基礎表格但是在渲染時卻出現了一些非預期的樣式問題。具體來說，某些單元格的邊框沒有正確顯示，而且在不同瀏覽器中表現不一致。我已經檢查了CSS，但找不到問題所在。有人能幫忙看看可能是哪裡出了問題嗎？',
          date: '2024-10-02 11:45',
          author: {
            name: '小明',
            avatar: '../assets/images/user/user-3.png',
          },
          status: 'resolved',
          tags: ['JavaScript', 'HTML', 'CSS', '瀏覽器兼容性'],
          responses: [
            {
              id: 'r4',
              author: 'Table專家',
              avatar: '../assets/images/user/user-4.png',
              content:
                '小明你好，這聽起來可能是CSS中collapse屬性設置問題。請檢查你的table是否有設置border-collapse: collapse;。另外，不同瀏覽器對於table的默認樣式也有所不同，建議你重置一下表格的默認樣式。這裡有一個基礎的CSS重置代碼：[代碼片段]',
              date: '2024/10/2 13:30',
              likes: 8,
            },
          ],
        },
        {
          id: '4',
          category: 'CSS',
          responseCount: 20,
          title: 'clip-path繪製不規則圖形',
          content:
            '對使用 clip-path 繪製不規則圖形有興趣，但不太理解如何操作。我想要製作一個類似雲朵形狀的背景元素，但是不確定如何定義這種複雜的路徑。有沒有一些工具或者技巧可以幫助我更容易地創建和調整 clip-path 的值？另外，clip-path 的瀏覽器兼容性如何？',
          date: '2024-10-02 16:20',
          author: {
            name: '設計新手',
            avatar: '../assets/images/user/user-4.png',
          },
          status: 'in-progress',
          tags: ['CSS', 'clip-path', '圖形設計'],
          responses: [
            {
              id: 'r5',
              author: 'CSS魔法師',
              avatar: '../assets/images/user/user-5.png',
              content:
                '嗨，設計新手！使用 clip-path 確實可以創建很酷的形狀。對於複雜的形狀如雲朵，我推薦使用 Clippy 這個在線工具：[Clippy連結]。你可以在這裡視覺化地創建和調整你的 clip-path。至於兼容性，現代瀏覽器支持都不錯，但 IE 不支持，需要注意。',
              date: '2024/10/3 09:45',
              likes: 15,
            },
          ],
        },
        {
          id: '5',
          category: 'API',
          responseCount: 5,
          title: 'API 疑問',
          content:
            '最近接手了一個新項目，需要調用一個第三方 API。但在實際操作中遇到了一些問題，特別是在處理 API 返回的數據時。有時候 API 返回的數據結構似乎和文檔描述的不太一致，導致我的代碼無法正確解析。另外，我也不太確定如何有效地處理 API 的錯誤響應。有經驗的開發者能分享一些處理第三方 API 的最佳實踐嗎？',
          date: '2024-10-03 10:05',
          author: {
            name: 'API新手',
            avatar: '../assets/images/user/user-5.png',
          },
          status: 'pending',
          tags: ['API', '錯誤處理', '數據解析'],
          responses: [
            {
              id: 'r6',
              author: 'Backend大神',
              avatar: '../assets/images/user/user-6.png',
              content:
                '處理第三方 API 確實可能會遇到各種挑戰。首先，我建議你使用類似 Postman 的工具直接測試 API，確認返回的數據結構。對於不一致的情況，可以考慮寫一個適配器來轉換數據。關於錯誤處理，務必使用 try-catch 來捕獲可能的異常，並為不同的錯誤碼設置相應的處理邏輯。這裡有一篇文章詳細討論了 API 錯誤處理的最佳實踐：[文章連結]',
              date: '2024/10/3 11:30',
              likes: 7,
            },
          ],
        },
        {
          id: '6',
          category: 'React',
          responseCount: 18,
          title: 'React Hooks 使用技巧',
          content:
            '想深入了解 React Hooks 的進階使用技巧，特別是在複雜組件中如何有效管理狀態和副作用。我已經掌握了基礎的 useState 和 useEffect，但在處理複雜的狀態邏輯時還是感到困惑。比如，如何優化性能以避免不必要的重渲染？useCallback 和 useMemo 應該在什麼情況下使用？還有自定義 Hook 的最佳實踐是什麼？',
          date: '2024-10-03 13:40',
          author: {
            name: 'React學習者',
            avatar: '../assets/images/user/user-6.png',
          },
          status: 'in-progress',
          tags: ['React', 'Hooks', '狀態管理', '性能優化'],
          responses: [
            {
              id: 'r7',
              author: 'Hook專家',
              avatar: '../assets/images/user/user-7.png',
              content:
                '您提出了一些很好的問題！對於複雜狀態管理，可以考慮使用 useReducer 來組織邏輯。性能優化方面，useCallback 用於緩存回調函數，useMemo 用於緩存計算結果，它們主要用在子組件重渲染優化上。這裡有一個實用的性能優化指南：[指南連結]。關於自定義 Hook，建議遵循單一職責原則，使其可重用且易測試。',
              date: '2024/10/3 15:20',
              likes: 22,
            },
          ],
        },
        {
          id: '7',
          category: 'TypeScript',
          responseCount: 10,
          title: 'TypeScript 高級類型技巧',
          content:
            '想深入學習 TypeScript 的高級類型，如條件類型、映射類型等，以提高代碼的類型安全性和可讀性。同時也希望了解泛型在實際項目中的最佳實踐。我發現在處理一些複雜的數據結構時，類型定義變得非常繁瑣，不知道有什麼技巧可以簡化這個過程？另外，如何在 TypeScript 中優雅地處理可能為 undefined 或 null 的值？',
          date: '2024-10-03 17:55',
          author: {
            name: 'TS愛好者',
            avatar: '../assets/images/user/user-7.png',
          },
          status: 'pending',
          tags: ['TypeScript', '高級類型', '泛型', '最佳實踐'],
          responses: [
            {
              id: 'r8',
              author: 'TS大師',
              avatar: '../assets/images/user/user-8.png',
              content:
                'TypeScript的高級類型確實可以大大提升代碼質量。對於複雜數據結構，可以利用 Partial<T>、Pick<T, K> 等工具類型來簡化定義。處理 null 或 undefined 值時，可以使用可選鏈操作符 ?. 和空值合並操作符 ??。這裡有一個很棒的 TypeScript 高級類型教程：[教程連結]。對於泛型，建議在設計通用組件或函數時廣泛使用，可以大大提高代碼的覆用性。',
              date: '2024/10/4 09:10',
              likes: 15,
            },
          ],
        },
        {
          id: '8',
          category: 'Performance',
          responseCount: 22,
          title: 'Web 應用性能優化與監控',
          content:
            '尋求有效的前端性能優化策略，包括如何減少頁面加載時間、優化資源請求，以及提升整體用戶體驗。同時也想了解如何有效地監控性能並進行針對性優化。特別是在大型 SPA 應用中，如何解決首次加載慢的問題？另外，有哪些工具可以幫助我們進行性能分析和監控？',
          date: '2024-10-04 09:30',
          author: {
            name: '速度狂熱者',
            avatar: '../assets/images/user/user-8.png',
          },
          status: 'in-progress',
          tags: ['性能優化', 'Web性能', '監控', '用戶體驗'],
          responses: [
            {
              id: 'r9',
              author: '性能優化專家',
              avatar: '../assets/images/user/user-9.png',
              content:
                '優化Web應用性能是一個複雜的話題，但這裡有一些關鍵策略：1) 使用懶加載和代碼分割來減少初始加載時間。2) 優化圖片，使用現代格式如WebP。3) 利用瀏覽器緩存和CDN。對於監控，推薦使用Google的Lighthouse和Chrome的Performance面板。對於SPA的首次加載問題，可以考慮服務端渲染(SSR)或靜態站點生成(SSG)。這裡有一個詳細的性能優化清單：[清單連結]',
              date: '2024/10/4 11:45',
              likes: 28,
            },
            {
              id: 'r10',
              author: '監控達人',
              avatar: '../assets/images/user/user-10.png',
              content:
                '補充一點關於性能監控的建議：可以使用像New Relic或Datadog這樣的工具來進行實時監控。它們可以幫助你追踪關鍵指標如TTFB（Time to First Byte）和LCP（Largest Contentful Paint）。另外，設置自定義的性能預算並定期審查也是一個好習慣。這可以幫助你在性能下降時及時發現並解決問題。',
              date: '2024/10/4 14:20',
              likes: 15,
            },
          ],
        },
        {
          id: '9',
          category: 'Accessibility',
          responseCount: 7,
          title: 'Web 無障礙設計與ARIA實踐',
          content:
            '想了解更多關於 Web 無障礙設計的最佳實踐，如何確保網站對所有用戶都是可訪問的，包括使用輔助技術的用戶。特別關注ARIA屬性的應用，以提高Web應用的可訪問性。我們的團隊正在開發一個大型的企業內部系統，需要符合WCAG 2.1的AA級標準，但對如何正確實施感到困惑。有哪些常見的錯誤需要避免？如何測試我們的應用是否真的達到了無障礙標準？',
          date: '2024-10-04 12:10',
          author: {
            name: '無障礙倡導者',
            avatar: '../assets/images/user/user-9.png',
          },
          status: 'pending',
          tags: ['無障礙設計', 'ARIA', 'WCAG', '包容性設計'],
          responses: [
            {
              id: 'r11',
              author: 'A11Y專家',
              avatar: '../assets/images/user/user-1.png',
              content:
                '實現真正的Web無障礙性確實是一個挑戰，但絕對值得。首先，確保您的HTML結構語義化，正確使用標題層級。關於ARIA，記住"無ARIA勝過錯誤的ARIA"這個原則。常見錯誤包括：未提供足夠的顏色對比度、僅依賴顏色傳遞信息、缺少表單標籤等。測試方面，推薦使用WAVE、aXe等自動化工具，同時進行手動測試和真實用戶測試。這裡有一個詳細的無障礙檢查清單：[清單連結]',
              date: '2024/10/4 14:30',
              likes: 12,
            },
          ],
        },
        {
          id: '10',
          category: 'GraphQL',
          responseCount: 14,
          title: 'GraphQL 應用與優化',
          content:
            '在選擇 API 架構時對比 GraphQL 和 RESTful API，想了解它們各自的優缺點以及適用場景。同時也希望了解一些 GraphQL 查詢性能優化的技巧和最佳實踐。我們正在考慮將一個大型的微服務架構從REST遷移到GraphQL，但擔心性能和複雜性問題。如何有效地組織GraphQL schema？在處理複雜的嵌套查詢時，如何避免N+1問題？',
          date: '2024-10-04 15:25',
          author: {
            name: 'API架構師',
            avatar: '../assets/images/user/user-10.png',
          },
          status: 'in-progress',
          tags: ['GraphQL', 'API設計', 'REST', '性能優化'],
          responses: [
            {
              id: 'r12',
              author: 'GraphQL大師',
              avatar: '../assets/images/user/user-2.png',
              content:
                'GraphQL相比REST的主要優勢是靈活性和減少過度獲取。它特別適合前端需求經常變化的場景。然而，它也帶來了後端複雜性增加的挑戰。對於schema組織，建議使用模塊化方法，將相關的類型和解析器組織在一起。處理N+1問題，可以使用數據加載庫如DataLoader進行批處理和緩存。性能優化技巧包括：實施查詢深度限制、使用片段來重用字段選擇等。這裡有一個GraphQL最佳實踐指南：[指南連結]',
              date: '2024/10/4 17:40',
              likes: 18,
            },
            {
              id: 'r13',
              author: 'REST擁護者',
              avatar: '../assets/images/user/user-3.png',
              content:
                '雖然GraphQL有其優勢，但也不要忽視REST的強大之處。REST with HATEOAS可以提供很好的API探索性。對於微服務架構，混合使用REST和GraphQL可能是個好選擇，將GraphQL作為BFF（Backend for Frontend）層。這樣可以結合兩者的優點，同時降低遷移風險。無論選擇哪種方案，良好的API設計原則都是適用的，如版本控制、錯誤處理等。',
              date: '2024/10/5 09:15',
              likes: 10,
            },
          ],
        },
      ];

      // 工具函數
      const utils = {
        formatDate(date) {
          return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${date
            .getMinutes()
            .toString()
            .padStart(2, '0')}`;
        },
        formatOnlyDate(date) {
          return `${date.getMonth() + 1}月${date.getDate()}日`;
        },
        formatOnlyTime(date) {
          return `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
        },
        debounce(func, wait) {
          let timeout;
          return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
          };
        },
      };

      // 卡片相關功能
      const cardManager = {
        createCardHTML(card) {
          return `
      <div class="card-wrapper" data-date="${card.date}" data-card-id="${card.id}">
        <div class="card-back">
          <span class="category">${card.category}</span>
          <div class="response-count">
            <span class="material-symbols-outlined">comment</span>
            <span>${card.responseCount}</span>
          </div>
        </div>
        <div class="card-front">
          <div class="card-content">
            <div class="card-title">
              <span class="material-symbols-outlined icon-fill text-brand-03">check_circle</span>
              <h2>${card.title}</h2>
            </div>
            <p>${card.content}</p>
          </div>
        </div>
      </div>
    `;
        },
        renderCards() {
          const cardsContainer = document.querySelector('.cards-container');
          cardsContainer.innerHTML = '';

          if (window.innerWidth <= 576) {
            cardData.forEach((card) => {
              const cardElement = document.createElement('div');
              cardElement.innerHTML = this.createCardHTML(card);
              cardsContainer.appendChild(cardElement.firstElementChild);
            });
          } else {
            const [row1, row2] = [document.createElement('div'), document.createElement('div')];
            [row1, row2].forEach((row) => (row.className = 'card_row'));

            cardData.forEach((card, index) => {
              const cardElement = document.createElement('div');
              cardElement.innerHTML = this.createCardHTML(card);
              (index % 2 === 0 ? row1 : row2).appendChild(cardElement.firstElementChild);
            });

            cardsContainer.append(row1, row2);
          }
          bindCardClickEvents();
        },
      };

      // 時間軸相關功能
      const timelineManager = {
        generateTimeline() {
          const timelineContainer = document.querySelector('.timeline-container');
          timelineContainer.innerHTML = '';
          const cards = document.querySelectorAll('.card-wrapper');

          if (window.innerWidth <= 576) {
            let lastDate = null;
            cards.forEach((card) => {
              const dateObj = new Date(card.dataset.date);
              const currentDate = utils.formatOnlyDate(dateObj);

              if (currentDate !== lastDate) {
                const timelinePoint = document.createElement('div');
                timelinePoint.className = 'timeline-point';
                const dateElement = document.createElement('span');
                dateElement.className = 'date';
                dateElement.textContent = currentDate;
                timelinePoint.appendChild(dateElement);
                card.insertBefore(timelinePoint, card.firstChild);
                lastDate = currentDate;
              }
            });
          } else {
            cards.forEach((card) => {
              const timelinePoint = document.createElement('div');
              timelinePoint.className = 'timeline-point';
              timelinePoint.style.left = `${card.offsetLeft}px`;
              timelinePoint.textContent = utils.formatDate(new Date(card.dataset.date));
              timelineContainer.appendChild(timelinePoint);
            });
          }
        },
      };

      // 滾動相關功能
      const scrollManager = {
        addScrollButtons() {
          const wishpool = document.querySelector('.wishpool-container');
          const [leftButton, rightButton] = [document.querySelector('.left-btn'), document.querySelector('.right-btn')];

          leftButton.onclick = () => wishpool.scrollBy({ left: -200, behavior: 'smooth' });
          rightButton.onclick = () => wishpool.scrollBy({ left: 200, behavior: 'smooth' });
        },
        addScrollFunctionality() {
          const wishpool = document.querySelector('.wishpool-container');
          let isDown = false;
          let startX;
          let scrollLeft;

          wishpool.addEventListener('wheel', (e) => {
            if (window.innerWidth > 576) {
              e.preventDefault();
              wishpool.scrollLeft += e.deltaY;
            }
          });

          wishpool.addEventListener('mousedown', (e) => {
            isDown = true;
            wishpool.style.cursor = 'grabbing';
            startX = e.pageX - wishpool.offsetLeft;
            scrollLeft = wishpool.scrollLeft;
          });

          wishpool.addEventListener('mouseleave', () => {
            isDown = false;
            wishpool.style.cursor = 'grab';
          });

          wishpool.addEventListener('mouseup', () => {
            isDown = false;
            wishpool.style.cursor = 'grab';
          });

          wishpool.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - wishpool.offsetLeft;
            const walk = (x - startX) * 2;
            wishpool.scrollLeft = scrollLeft - walk;
          });
        },
        updateScrollButtonVisibility() {
          const wishpool = document.querySelector('.wishpool-container');
          const [leftButton, rightButton] = [document.querySelector('.left-btn'), document.querySelector('.right-btn')];

          if (window.innerWidth <= 576) {
            [leftButton, rightButton].forEach((button) => (button.style.display = 'none'));
          } else {
            [leftButton, rightButton].forEach((button) => (button.style.display = ''));
            const canScrollLeft = wishpool.scrollLeft > 0;
            const canScrollRight = wishpool.scrollLeft < wishpool.scrollWidth - wishpool.clientWidth;
          }
        },
      };

      function adjustMainContentPadding() {
        const [header, footer, mainContent] = [
          document.querySelector('.header-custom-course'),
          document.querySelector('.footer-learning-needs'),
          document.querySelector('.main-content'),
        ];

        const headerHeight = header ? header.offsetHeight : 0;
        const footerHeight = footer ? footer.offsetHeight : 0;

        mainContent.style.paddingTop = `${headerHeight}px`;
        mainContent.style.paddingBottom = `${footerHeight}px`;
      }

      function applyRandomPositioning() {
        if (window.innerWidth <= 576) return;

        const cards = document.querySelectorAll('.card-wrapper');
        const maxOffset = 20;

        cards.forEach((card) => {
          const [randomX, randomY] = [Math.random() - 0.5, Math.random() - 0.5].map((n) => n * 2 * maxOffset);
          Object.assign(card.style, {
            position: 'relative',
            left: `${randomX}px`,
            top: `${randomY}px`,
            transition: 'all 0.5s ease',
          });
        });
      }

      function initRandomPositioning() {
        cardManager.renderCards();
        setTimeout(applyRandomPositioning, 100);
      }

      function initWishpool() {
        adjustMainContentPadding();
        initRandomPositioning();
        cardManager.renderCards();
        timelineManager.generateTimeline();
        scrollManager.addScrollButtons();
        scrollManager.addScrollFunctionality();
        scrollManager.updateScrollButtonVisibility();

        document
          .querySelector('.wishpool-container')
          .addEventListener('scroll', scrollManager.updateScrollButtonVisibility);
      }

      window.addEventListener(
        'resize',
        utils.debounce(() => {
          initRandomPositioning();
          timelineManager.generateTimeline();
          scrollManager.updateScrollButtonVisibility();
          adjustMainContentPadding();
        }, 250),
      );

      function openCardModal(cardId) {
        const card = cardData.find((c) => c.id === cardId);
        if (!card) return;

        const modalElements = {
          title: document.getElementById('cardModalLabel'),
          authorAvatar: document.getElementById('modalAuthorAvatar'),
          authorName: document.getElementById('modalAuthorName'),
          content: document.getElementById('modalContent'),
          tags: document.getElementById('modalTags'),
          date: document.getElementById('modalDate'),
          photo: document.getElementById('modalPhoto'),
          responses: document.getElementById('modalResponses'),
        };

        modalElements.title.textContent = card.title;
        modalElements.authorAvatar.src = card.author.avatar;
        modalElements.authorName.textContent = card.author.name;
        modalElements.content.textContent = card.content;
        modalElements.date.textContent = card.date;

        // 處理照片
        if (card.photo) {
          modalElements.photo.src = card.photo;
          modalElements.photo.style.display = 'block';
        } else {
          modalElements.photo.src = 'https://i.ytimg.com/vi/YBTZYFY20Mk/maxresdefault.jpg'; // 請替換為您的預設照片路徑
          modalElements.photo.style.display = 'block';
        }

        modalElements.tags.innerHTML = card.tags
          .map((tag) => `<span class="badge bg-secondary me-1">${tag}</span>`)
          .join('');

        modalElements.responses.innerHTML = card.responses
          .map(
            (response) => `
    <div class="card mb-3 border-0 bg-light">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="d-flex align-items-center">
            <img src="${response.avatar}" alt="${response.author} 頭像" class="rounded-circle me-2" width="32" height="32">
            <div>
              <h6 class="mb-0 fw-bold">${response.author}</h6>
              <small class="text-muted">${response.date}</small>
            </div>
          </div>
          <div class="dropdown">
            <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <span class="material-symbols-outlined">more_vert</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#">編輯</a></li>
              <li><a class="dropdown-item" href="#">刪除</a></li>
              <li><a class="dropdown-item" href="#">舉報</a></li>
            </ul>
          </div>
        </div>
        <p class="card-text mb-2">${response.content}</p>
        <div class="d-flex align-items-center">
          <button class="btn btn-sm btn-light me-2 like-button d-flex align-items-center" data-response-id="${response.id}">
            <span class="material-symbols-outlined icon-fill me-1">thumb_up</span>
            <span class="like-count">${response.likes}</span>
          </button>
          <button class="btn btn-sm btn-light d-flex align-items-center">
            <span class="material-symbols-outlined me-1">comment</span> 回覆
          </button>
        </div>
      </div>
    </div>
  `,
          )
          .join('');

        const cardModal = document.getElementById('cardModal');
        const modal = bootstrap.Modal.getInstance(cardModal) || new bootstrap.Modal(cardModal);
        modal.show();
      }

      function bindCardClickEvents() {
        document.querySelectorAll('.card-wrapper').forEach((card) => {
          card.addEventListener('click', function () {
            openCardModal(this.dataset.cardId);
          });
        });
      }

      document.addEventListener('DOMContentLoaded', function () {
        const newResponseForm = document.getElementById('newResponseForm');
        const modalResponses = document.getElementById('modalResponses');

        newResponseForm.addEventListener('submit', function (e) {
          e.preventDefault();
          const newResponseText = document.getElementById('newResponseText').value;
          if (newResponseText.trim()) {
            const newResponseElement = document.createElement('div');
            newResponseElement.className = 'card mb-3 border-0 bg-light';
            newResponseElement.innerHTML = `
        <div class="card-body p-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="d-flex align-items-center">
              <img src="../assets/images/user/user-1.png" alt="Your Avatar" class="rounded-circle me-2" width="32" height="32">
              <div>
                <h6 class="mb-0 fw-bold">You</h6>
                <small class="text-muted">${new Date().toLocaleString()}</small>
              </div>
            </div>
            <div class="dropdown">
              <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="material-symbols-outlined">more_vert</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">編輯</a></li>
                <li><a class="dropdown-item" href="#">刪除</a></li>
                <li><a class="dropdown-item" href="#">舉報</a></li>
              </ul>
            </div>
          </div>
          <p class="card-text mb-2">${newResponseText}</p>
          <div class="d-flex align-items-center">
            <button class="btn btn-sm btn-light me-2 like-button d-flex align-items-center" data-response-id="new">
              <span class="material-symbols-outlined icon-fill me-1">thumb_up</span>
              <span class="like-count">0</span>
            </button>
            <button class="btn btn-sm btn-light d-flex align-items-center">
              <span class="material-symbols-outlined me-1">comment</span>
              <span>回覆</span>
            </button>
          </div>
        </div>
      `;
            modalResponses.appendChild(newResponseElement);
            document.getElementById('newResponseText').value = '';
          }
        });

        modalResponses.addEventListener('click', function (e) {
          if (e.target.closest('.like-button')) {
            const likeButton = e.target.closest('.like-button');
            const likeCount = likeButton.querySelector('.like-count');
            let currentLikes = parseInt(likeCount.textContent);
            likeCount.textContent = currentLikes + 1;
          }
        });

        initWishpool();
        bindCardClickEvents();
      });

      // 狀態按鈕功能
      document.querySelectorAll('.status-btn').forEach((button) => {
        button.addEventListener('click', function () {
          const icon = this.querySelector('.material-symbols-outlined');
          if (icon.textContent === 'radio_button_unchecked') {
            icon.textContent = 'check_circle';
            icon.classList.add('icon-fill');
          } else {
            icon.textContent = 'radio_button_unchecked';
            icon.classList.remove('icon-fill');
          }
        });
      });
    </script>

    <!-- <script src="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->
  </body>
</html>
